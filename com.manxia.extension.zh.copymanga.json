{
  "metadata": {
    "id": "copymanga",
    "name": "拷贝漫画",
    "version": "1.0.0",
    "language": "zh-CN",
    "baseUrl": "https://www.copy20.com",
    "description": "拷贝漫画 - 中文漫画图源，支持域名切换、简繁转换、UA轮换等高级功能",
    "author": "ManXia Team",
    "nsfw": true,
    "tags": ["chinese", "popular"],
    "alternativeUrls": {
      "mangacopy": "https://api.mangacopy.com",
      "copymanga_tv": "https://api.copymanga.tv",
      "copymanga_org": "https://api.copymanga.org",
      "copymanga_info": "https://api.copymanga.info",
      "copymanga_net": "https://api.copymanga.net",
      "xsskc": "https://api.xsskc.com",
      "copymanga_site": "https://api.copymanga.site",
      "copy20": "https://www.copy20.com"
    }
  },

  "capabilities": {
    "urlResolver": true,
    "chineseConverter": true,
    "pagination": true,
    "userAgentRotation": true,
    "errorRetry": true,
    "sessionManagement": false
  },

  "network": {
    "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
    "headers": {
      "Accept": "application/json, text/plain, */*",
      "Accept-Language": "zh-CN,zh;q=0.9,en;q=0.8",
      "Accept-Encoding": "gzip, deflate, br",
      "Referer": "{{baseUrl}}",
      "Origin": "{{baseUrl}}"
    },
    "timeout": 30000,
    "retryCount": 3,
    "retryDelay": 1000,
    "userAgentRotation": {
      "enabled": true,
      "strategy": "random",
      "pool": [
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
        "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
        "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0"
      ],
      "rotateInterval": 10,
      "persistPerSession": true
    },
    "rateLimit": {
      "enabled": true,
      "requestsPerSecond": 2,
      "burstSize": 5
    }
  },

  "api": {
    "type": "rest",
    "endpoint": "https://{{baseUrl}}/api/v3",
    "authentication": {
      "type": "cookie",
      "requiresLogin": false
    }
  },

  "settings": {
    "apiDomain": {
      "type": "select",
      "name": "API域名",
      "description": "选择要使用的API服务器",
      "default": "copy20",
      "options": [
        {"value": "copy20", "label": "Copy20 (推荐)"},
        {"value": "mangacopy", "label": "MangaCopy API"},
        {"value": "copymanga_tv", "label": "CopyManga.tv"},
        {"value": "copymanga_org", "label": "CopyManga.org"},
        {"value": "xsskc", "label": "XSSKC镜像"}
      ]
    },
    "imageQuality": {
      "type": "select",
      "name": "图片质量",
      "description": "选择图片质量",
      "default": "800",
      "options": [
        {"value": "800", "label": "标准 (800px)"},
        {"value": "1200", "label": "高清 (1200px)"},
        {"value": "1500", "label": "超清 (1500px)"}
      ]
    },
    "enableBookshelf": {
      "type": "boolean",
      "name": "启用书柜同步",
      "description": "同步拷贝漫画账号的书柜（需登录）",
      "default": false
    }
  },

  "textProcessing": {
    "chineseConversion": {
      "enabled": true,
      "direction": "auto",
      "applyTo": ["title", "description", "chapterTitle"],
      "variant": "zh-CN"
    },
    "cleaning": {
      "enabled": true,
      "rules": [
        {"type": "trim"},
        {"type": "normalizeWhitespace"}
      ]
    }
  },

  "errorHandling": {
    "retry": {
      "enabled": true,
      "maxAttempts": 3,
      "strategy": "exponential",
      "baseDelay": 1000,
      "maxDelay": 30000,
      "retryOn": {
        "statusCodes": [408, 429, 500, 502, 503, 504],
        "errors": ["TIMEOUT", "NETWORK_ERROR"]
      }
    },
    "fallback": {
      "enabled": true,
      "strategies": [
        {"type": "alternativeUrl", "url": "{{alternativeUrls.copy20}}"},
        {"type": "webview"}
      ]
    }
  },

  "workflows": {
    "initialize": {
      "description": "初始化会话",
      "actions": [
        {
          "type": "http",
          "method": "GET",
          "url": "{{baseUrl}}",
          "description": "访问首页建立基础Cookie"
        }
      ]
    },

    "popular": {
      "description": "获取热门漫画",
      "actions": [
        {
          "type": "api",
          "method": "GET",
          "url": "{{api.endpoint}}/recs",
          "params": {
            "pos": "3200102",
            "limit": "{{limit|30}}",
            "offset": "{{offset|0}}"
          },
          "headers": "{{network.headers}}",
          "extract": {
            "type": "json",
            "path": "results.list",
            "fields": {
              "id": "comic.path_word",
              "title": "comic.name",
              "cover": "comic.cover",
              "author": "comic.author[0].name",
              "description": "comic.brief",
              "status": "comic.status.display",
              "genres": "comic.theme[*].name",
              "url": "{{baseUrl}}/comic/{{comic.path_word}}"
            }
          }
        }
      ]
    },

    "latest": {
      "description": "获取最新更新",
      "actions": [
        {
          "type": "api",
          "method": "GET",
          "url": "{{api.endpoint}}/update/newest",
          "params": {
            "limit": "{{limit|30}}",
            "offset": "{{offset|0}}"
          },
          "headers": "{{network.headers}}",
          "extract": {
            "type": "json",
            "path": "results.list",
            "fields": {
              "id": "comic.path_word",
              "title": "comic.name",
              "cover": "comic.cover",
              "author": "comic.author[0].name",
              "updateTime": "comic.datetime_updated"
            }
          }
        }
      ]
    },

    "search": {
      "description": "搜索漫画",
      "actions": [
        {
          "type": "api",
          "method": "GET",
          "url": "{{api.endpoint}}/search/comic",
          "params": {
            "q": "{{query}}",
            "limit": "{{limit|30}}",
            "offset": "{{offset|0}}",
            "platform": "2"
          },
          "headers": "{{network.headers}}",
          "extract": {
            "type": "json",
            "path": "results.list",
            "fields": {
              "id": "comic.path_word",
              "title": "comic.name",
              "cover": "comic.cover",
              "author": "comic.author[0].name"
            }
          }
        }
      ]
    },

    "getMangaDetail": {
      "description": "获取漫画详情",
      "actions": [
        {
          "type": "api",
          "method": "GET",
          "url": "{{api.endpoint}}/comic2/{{mangaId}}",
          "headers": "{{network.headers}}",
          "extract": {
            "type": "json",
            "path": "results.comic",
            "fields": {
              "id": "path_word",
              "title": "name",
              "cover": "cover",
              "author": "author[0].name",
              "description": "brief",
              "status": "status.display",
              "genres": "theme[*].name",
              "rating": "popular",
              "updateTime": "datetime_updated"
            }
          }
        }
      ]
    },

    "getChapterList": {
      "description": "获取章节列表",
      "actions": [
        {
          "type": "api",
          "method": "GET",
          "url": "{{api.endpoint}}/comic/{{mangaId}}/group/default/chapters",
          "params": {
            "limit": "500",
            "offset": "0",
            "ordering": "-datetime_created"
          },
          "headers": "{{network.headers}}",
          "extract": {
            "type": "json",
            "path": "results.list",
            "fields": {
              "id": "uuid",
              "title": "name",
              "index": "index",
              "publishTime": "datetime_created",
              "url": "{{baseUrl}}/comic/{{mangaId}}/chapter/{{uuid}}"
            }
          }
        }
      ]
    },

    "getPageList": {
      "description": "获取章节页面列表",
      "actions": [
        {
          "type": "api",
          "method": "GET",
          "url": "{{api.endpoint}}/comic/{{mangaId}}/chapter2/{{chapterId}}",
          "headers": "{{network.headers}}",
          "extract": {
            "type": "json",
            "path": "results.chapter.contents",
            "fields": {
              "url": "url"
            }
          }
        }
      ]
    },

    "getImageUrl": {
      "description": "获取图片URL",
      "actions": [
        {
          "type": "direct",
          "description": "直接返回图片URL，无需额外处理",
          "extract": {
            "type": "passthrough",
            "field": "url"
          }
        }
      ]
    }
  },

  "imageProcessing": {
    "urlTransform": {
      "enabled": false
    },
    "headers": {
      "Referer": "{{baseUrl}}",
      "Accept": "image/avif,image/webp,image/png,image/jpeg,*/*"
    }
  },

  "notes": [
    "注意：CopyManga需要特定的User-Agent才能正常访问",
    "如果遇到只能看5页的问题，请尝试更换User-Agent",
    "支持切换到热辣漫画API（在设置中选择）",
    "登录后可以同步书柜漫画"
  ],

  "changelog": [
    {
      "version": "1.0.0",
      "date": "2024-11-21",
      "changes": [
        "初始版本",
        "支持热门、最新、搜索功能",
        "支持User-Agent轮换",
        "支持域名切换"
      ]
    }
  ]
}
