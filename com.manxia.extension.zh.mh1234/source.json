{
  "metadata": {
    "id": "com.manxia.extension.zh.mh1234",
    "name": "漫画1234",
    "type": "manga",
    "version": "2.0.0",
    "language": "zh-CN",
    "baseUrl": "https://m.wmh1234.com",
    "description": "漫画1234 - 国漫、日漫为主",
    "author": "ManXia Team (移植自 keiyoushi)",
    "nsfw": false,
    "tags": ["chinese", "webview", "free"],
    "Internet": false
  },

  "capabilities": {
    "urlResolver": true,
    "pagination": true,
    "errorRetry": true,
    "loginSupport": false
  },

  "network": {
    "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
    "timeout": 30000,
    "retryCount": 3,
    "retryDelay": 2000
  },

  "workflows": {
    "popular": {
      "description": "获取热门漫画",
      "actions": [
        {
          "type": "navigate",
          "url": "https://m.wmh1234.com/custom/top",
          "timeout": 10000,
          "description": "导航到热门漫画页"
        },
        {
          "type": "wait",
          "condition": "element",
          "selector": ".comic-card",
          "timeout": 8000,
          "description": "等待漫画列表加载"
        },
        {
          "type": "script",
          "code": "(() => { const baseUrl = 'https://m.wmh1234.com'; const cards = document.querySelectorAll('.comic-card'); const list = []; cards.forEach(card => { const link = card.querySelector('.comic-card__link'); const title = card.querySelector('.comic-card__title'); const img = card.querySelector('.comic-card__image'); if (link && title) { const href = link.getAttribute('href') || ''; const fullUrl = href.startsWith('http') ? href : baseUrl + href; list.push({ id: fullUrl, title: title.textContent.trim(), cover: img?.getAttribute('data-src') || img?.src || '' }); } }); return JSON.stringify(list); })();",
          "description": "提取热门漫画列表"
        }
      ]
    },

    "latest": {
      "description": "获取最新更新",
      "actions": [
        {
          "type": "navigate",
          "url": "https://m.wmh1234.com/custom/update",
          "timeout": 10000,
          "description": "导航到最新更新页"
        },
        {
          "type": "wait",
          "condition": "element",
          "selector": ".comic-card",
          "timeout": 8000,
          "description": "等待漫画列表加载"
        },
        {
          "type": "script",
          "code": "(() => { const baseUrl = 'https://m.wmh1234.com'; const cards = document.querySelectorAll('.comic-card'); const list = []; cards.forEach(card => { const link = card.querySelector('.comic-card__link'); const title = card.querySelector('.comic-card__title'); const img = card.querySelector('.comic-card__image'); if (link && title) { const href = link.getAttribute('href') || ''; const fullUrl = href.startsWith('http') ? href : baseUrl + href; list.push({ id: fullUrl, title: title.textContent.trim(), cover: img?.getAttribute('data-src') || img?.src || '' }); } }); return JSON.stringify(list); })();",
          "description": "提取最新更新漫画"
        }
      ]
    },

    "search": {
      "description": "搜索漫画",
      "supportsPagination": false,
      "actions": [
        {
          "type": "navigate",
          "url": "https://m.wmh1234.com/search?key={{query}}",
          "timeout": 10000,
          "description": "导航到搜索结果页"
        },
        {
          "type": "wait",
          "condition": "element",
          "selector": ".comic-card, .empty-state",
          "timeout": 8000,
          "description": "等待搜索结果加载"
        },
        {
          "type": "script",
          "code": "(() => { const baseUrl = 'https://m.wmh1234.com'; const cards = document.querySelectorAll('.comic-card'); const list = []; cards.forEach(card => { const link = card.querySelector('.comic-card__link'); const title = card.querySelector('.comic-card__title'); const img = card.querySelector('.comic-card__image'); if (link && title) { const href = link.getAttribute('href') || ''; const fullUrl = href.startsWith('http') ? href : baseUrl + href; list.push({ id: fullUrl, title: title.textContent.trim(), cover: img?.getAttribute('data-src') || img?.src || '' }); } }); return JSON.stringify(list); })();",
          "description": "提取搜索结果"
        }
      ]
    },

    "getMangaDetail": {
      "description": "获取漫画详情",
      "actions": [
        {
          "type": "navigate",
          "url": "{{mangaId}}",
          "timeout": 10000,
          "description": "导航到漫画详情页"
        },
        {
          "type": "wait",
          "condition": "element",
          "selector": ".comic-hero__title",
          "timeout": 8000,
          "description": "等待详情加载"
        },
        {
          "type": "script",
          "code": "(() => { const title = document.querySelector('.comic-hero__title')?.textContent.trim() || ''; const cover = document.querySelector('.comic-hero__cover img')?.src || ''; const metaItems = document.querySelectorAll('.meta-item'); const author = metaItems[0]?.textContent.trim() || ''; const statValues = document.querySelectorAll('.stat-value'); let status = '未知'; if (statValues[0]) { const statusText = statValues[0].textContent.trim(); if (statusText === '完结') status = '已完结'; else if (statusText === '连载') status = '连载中'; } const description = document.querySelector('.comic-desc, #comicDesc')?.textContent.trim() || ''; return JSON.stringify({ title, cover, author, status, description }); })();",
          "description": "提取漫画详情"
        }
      ]
    },

    "getMangaDetailWithChapters": {
      "description": "获取漫画详情和章节列表",
      "actions": [
        {
          "type": "navigate",
          "url": "{{mangaId}}",
          "timeout": 10000,
          "description": "导航到漫画详情页"
        },
        {
          "type": "wait",
          "condition": "element",
          "selector": ".comic-hero__title",
          "timeout": 8000,
          "description": "等待详情加载"
        },
        {
          "type": "script",
          "code": "(() => { const title = document.querySelector('.comic-hero__title')?.textContent.trim() || ''; const cover = document.querySelector('.comic-hero__cover img')?.src || ''; const metaItems = document.querySelectorAll('.meta-item'); const author = metaItems[0]?.textContent.trim() || ''; const statValues = document.querySelectorAll('.stat-value'); let status = '未知'; if (statValues[0]) { const statusText = statValues[0].textContent.trim(); if (statusText === '完结') status = '已完结'; else if (statusText === '连载') status = '连载中'; } const description = document.querySelector('.comic-desc, #comicDesc')?.textContent.trim() || ''; return JSON.stringify({ title, cover, author, status, description }); })();",
          "description": "提取漫画详情"
        },
        {
          "type": "script",
          "code": "(() => { const baseUrl = 'https://m.wmh1234.com'; const chapters = []; const chapterLinks = document.querySelectorAll('.chapter-list .chapter-item'); chapterLinks.forEach((link) => { const href = link.getAttribute('href'); const title = link.querySelector('.chapter-title')?.textContent.trim() || link.textContent.trim(); if (href && title) { const fullUrl = href.startsWith('http') ? href : baseUrl + href; chapters.push({ id: fullUrl, title: title, date: '' }); } }); return JSON.stringify(chapters); })();",
          "description": "提取章节列表"
        }
      ]
    },

    "getChapterList": {
      "description": "获取章节列表",
      "actions": [
        {
          "type": "navigate",
          "url": "{{mangaId}}",
          "timeout": 10000,
          "description": "导航到漫画详情页"
        },
        {
          "type": "wait",
          "condition": "element",
          "selector": ".chapter-list",
          "timeout": 8000,
          "description": "等待章节列表加载"
        },
        {
          "type": "script",
          "code": "(() => { const baseUrl = 'https://m.wmh1234.com'; const chapters = []; const chapterLinks = document.querySelectorAll('.chapter-list .chapter-item'); chapterLinks.forEach((link) => { const href = link.getAttribute('href'); const title = link.querySelector('.chapter-title')?.textContent.trim() || link.textContent.trim(); if (href && title) { const fullUrl = href.startsWith('http') ? href : baseUrl + href; chapters.push({ id: fullUrl, title: title, date: '' }); } }); return JSON.stringify(chapters); })();",
          "description": "提取章节列表"
        }
      ]
    },

    "getPageList": {
      "description": "获取章节页面列表",
      "actions": [
        {
          "type": "navigate",
          "url": "{{chapterId}}",
          "timeout": 15000,
          "description": "导航到章节阅读页"
        },
        {
          "type": "wait",
          "condition": "element",
          "selector": ".reader-content .reader-image",
          "timeout": 10000,
          "description": "等待图片加载"
        },
        {
          "type": "script",
          "code": "(() => { const images = document.querySelectorAll('.reader-content .reader-image'); const pages = []; images.forEach((img, index) => { const dataSrc = img.getAttribute('data-src'); const src = img.src; const url = (dataSrc && dataSrc.startsWith('http')) ? dataSrc : src; if (url && !url.includes('placeholder.svg')) { pages.push({ index: index, url: url }); } }); console.log('[MH1234] 提取到', pages.length, '张图片'); return JSON.stringify(pages); })();",
          "description": "提取章节图片列表"
        }
      ]
    },

    "getImageUrl": {
      "description": "获取图片URL（直接返回，因为getPageList已返回完整URL）",
      "actions": [
        {
          "type": "script",
          "code": "return '{{imageUrl}}';",
          "description": "直接返回图片URL"
        }
      ]
    }
  },

  "imageHeaders": {
    "Referer": "https://m.wmh1234.com/",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
  }
}
